{"ast":null,"code":"var _jsxFileName = \"/Users/josh/Documents/VS Code/Projects/chat-app/client/src/pages/Chat.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport io from \"socket.io-client\";\nimport axios from 'axios';\nimport { contactRoute, createMessageRoute, getMessageRoute } from '../utils/apiRoutes';\nimport Contacts from '../components/Contacts/Contacts';\nimport MessageInput from '../components/Messages/MessageInput';\nimport MessageDisplay from '../components/Messages/MessageDisplay';\nimport Header from '../components/Header/Header';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Chat() {\n  _s();\n\n  const [contacts, setContacts] = useState();\n  const [user, setUser] = useState();\n  const [selected, setSelected] = useState();\n  const [messages, setMessages] = useState([]);\n  const socket = io.connect(\"http://localhost:5000\");\n  const navigate = useNavigate();\n  useEffect(() => {\n    socket.on(\"receive-msg\", data => {\n      console.log(data);\n      const msg = [messages];\n      const selectedMessages = data.filter((item, id) => {\n        return item.sender === selected._id && item.recipient === user._id || item.recipient === selected._id && item.sender === user._id;\n      });\n      msg.push(selectedMessages);\n      console.log(msg);\n      setMessages(msg);\n    });\n  }, [socket]); //Checks to see if user is logged in, redirects to login page if not\n\n  useEffect(() => {\n    if (!localStorage.getItem('user')) {\n      navigate('/login');\n    } else {\n      const userInfo = JSON.parse(localStorage.getItem('user'));\n      setUser(userInfo);\n    }\n  }, [navigate]); // Gets contact list for logged in user\n\n  useEffect(() => {\n    if (user) {\n      axios.get(`${contactRoute}/${user._id}`).then(data => {\n        setContacts(data.data);\n      });\n    }\n  }, [user]); //Shows different chats depending on selected contact\n\n  const handleSelectedChange = async selected => {\n    setSelected(selected);\n    const {\n      data\n    } = await axios.post(getMessageRoute, {\n      recipient: user._id,\n      sender: selected._id\n    });\n    let selectedMessages = data.filter((item, index) => {\n      return item.sender === selected._id && item.recipient === user._id || item.recipient === selected._id && item.sender === user._id;\n    });\n    setMessages(selectedMessages);\n  };\n\n  const logout = () => {\n    localStorage.removeItem('user');\n    navigate('/login');\n  };\n\n  const handleMessageSend = async message => {\n    try {\n      const {\n        data\n      } = await axios.post(createMessageRoute, {\n        body: message,\n        sender: user._id,\n        recipient: selected._id\n      });\n      socket.emit(\"send-msg\", {\n        body: message,\n        sender: user._id,\n        recipient: selected._id\n      });\n      console.log(data.msg);\n    } catch (ex) {\n      console.log(ex);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      user: user,\n      logout: logout\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(Contacts, {\n        contacts: contacts,\n        user: user,\n        changeSelected: handleSelectedChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(MessageDisplay, {\n        messages: messages,\n        selected: selected\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n        user: user,\n        selected: selected,\n        sendMessage: handleMessageSend\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Chat, \"pbxe1Q2Az/idRcgcbpRqMtU4X+c=\", false, function () {\n  return [useNavigate];\n});\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","io","axios","contactRoute","createMessageRoute","getMessageRoute","Contacts","MessageInput","MessageDisplay","Header","Chat","contacts","setContacts","user","setUser","selected","setSelected","messages","setMessages","socket","connect","navigate","on","data","console","log","msg","selectedMessages","filter","item","id","sender","_id","recipient","push","localStorage","getItem","userInfo","JSON","parse","get","then","handleSelectedChange","post","index","logout","removeItem","handleMessageSend","message","body","emit","ex"],"sources":["/Users/josh/Documents/VS Code/Projects/chat-app/client/src/pages/Chat.jsx"],"sourcesContent":["import React, { useState , useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport io from \"socket.io-client\";\nimport axios from 'axios';\nimport { contactRoute, createMessageRoute, getMessageRoute } from '../utils/apiRoutes';\nimport Contacts from '../components/Contacts/Contacts';\nimport MessageInput from '../components/Messages/MessageInput';\nimport MessageDisplay from '../components/Messages/MessageDisplay';\nimport Header from '../components/Header/Header';\n\nfunction Chat() {\n\n    const [contacts, setContacts] = useState();\n    const [user, setUser] = useState();\n    const [selected, setSelected] = useState();\n\tconst [messages, setMessages] = useState([]);\n\tconst socket = io.connect(\"http://localhost:5000\");\n\n    const navigate = useNavigate();\n\n\tuseEffect(() => {\n\t\tsocket.on(\"receive-msg\", (data) => {\n\t\t\tconsole.log(data)\n\t\t\tconst msg = [messages]\n\t\t\tconst selectedMessages = data.filter((item, id) => {\n\t\t\t\treturn (item.sender === selected._id && item.recipient === user._id) || (item.recipient === selected._id && item.sender === user._id)\n\t\t\t})\n\t\t\tmsg.push(selectedMessages)\n\t\t\tconsole.log(msg)\n\t\t\tsetMessages(msg)\n\t\t})}, [socket]);\n\n\t//Checks to see if user is logged in, redirects to login page if not\n    useEffect(() => {\n    \tif(!localStorage.getItem('user')) {\n        navigate('/login');\n\t\t}\n\t\telse {\n\t\t\tconst userInfo = JSON.parse(localStorage.getItem('user'));\n\t\t\tsetUser(userInfo);\n\t\t}\n    }, [navigate]);\n\n\t// Gets contact list for logged in user\n    useEffect(() => {\n      if(user) {\n        axios.get(`${contactRoute}/${user._id}`)\n          .then((data) => {\n            setContacts(data.data);\n          })\n      }\n    }, [user])\n\n\n\t//Shows different chats depending on selected contact\n    const handleSelectedChange = async (selected) => {\n\t\tsetSelected(selected)\n\t\tconst { data } = await axios.post(getMessageRoute, {\n\t\t\trecipient: user._id,\n\t\t\tsender: selected._id\n\t\t\t})\n\t\tlet selectedMessages = data.filter((item, index) => {\n\t\t\treturn (item.sender === selected._id && item.recipient === user._id) || (item.recipient === selected._id && item.sender === user._id)\n\t\t})\n\t\tsetMessages(selectedMessages)\n    };\n\n    const logout = () => {\n      localStorage.removeItem('user');\n\t  navigate('/login')\n    };\n\n    const handleMessageSend = async (message) => {\n\n\t\ttry{\n\t\t\tconst { data } = await axios.post(createMessageRoute, {\n\t\t\t\tbody: message,\n\t\t\t\tsender: user._id,\n\t\t\t\trecipient: selected._id\n\t\t\t})\n\t\t\tsocket.emit(\"send-msg\", {\n\t\t\t\tbody: message,\n\t\t\t\tsender: user._id,\n\t\t\t\trecipient: selected._id\n\t\t\t})\n\t\t\tconsole.log(data.msg)\n\t\t}catch(ex){\n\t\t\tconsole.log(ex)\n\t\t}\n    }\n\n    return (\n\t\t<>\n\t\t\t<Header user={user} logout={logout}/>\n\t\t\t<div className='container'>\n\t\t\t\t<Contacts contacts={contacts} user={user} changeSelected={handleSelectedChange}/>\n\t\t\t\t<MessageDisplay messages={messages} selected={selected}/>\n\t\t\t\t<MessageInput user={user} selected={selected} sendMessage={handleMessageSend}/>\n\t\t\t</div>\n\t\t</>\n\t)\n       \n}\n\nexport default Chat"],"mappings":"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"},"metadata":{},"sourceType":"module"}